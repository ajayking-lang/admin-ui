<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <style>
    body {
      background: #121212; color: #fff; font-family: Arial; padding: 20px;
    }
    .card {
      background: #1e1e1e; border-radius: 12px; padding: 15px; margin-bottom: 15px;
      box-shadow: 0 0 10px #000;
    }
    input, button {
      padding: 10px; border-radius: 6px; border: none;
      margin: 5px 0;
      width: 100%;
    }
    button { background: #03dac6; color: #000; cursor: pointer; }
    #status {
      background: #222; padding: 10px; margin-top: 10px;
      border-radius: 6px; font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>

  <div class="card">
    <h3>Add Device</h3>
    <input id="id" placeholder="Device ID"><br>
    <input id="name" placeholder="Device Name"><br>
    <input id="version" placeholder="Version"><br>
    <button onclick="addDevice()">Add Device</button>
  </div>

  <div class="card">
    <h3>Send SMS</h3>
    <input id="to" placeholder="Device ID"><br>
    <input id="msg" placeholder="Message"><br>
    <button onclick="sendSMS()">Send SMS</button>
  </div>

  <div id="status">Status: Ready</div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Optional: if running on a different port or IP
    // const socket = io("http://192.168.72.160:3000");
    const socket = io(); 

    function showStatus(msg, success = true) {
      const status = document.getElementById("status");
      status.textContent = `Status: ${msg}`;
      status.style.color = success ? "#0f0" : "#f55";
    }

    function addDevice() {
      const id = document.getElementById('id').value.trim();
      const name = document.getElementById('name').value.trim();
      const version = document.getElementById('version').value.trim();

      if (!id || !name || !version) {
        showStatus("All fields are required.", false);
        return;
      }

      fetch('/api/devices/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, name, version })
      }).then(res => res.json())
        .then(res => {
          if (res.ok) showStatus("Device added successfully.");
          else showStatus("Failed to add device.", false);
        }).catch(() => showStatus("Server error.", false));
    }

    function sendSMS() {
      const deviceId = document.getElementById('to').value.trim();
      const message = document.getElementById('msg').value.trim();

      if (!deviceId || !message) {
        showStatus("Device ID and message are required.", false);
        return;
      }

      fetch('/api/sms/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ deviceId, message })
      }).then(res => res.json())
        .then(res => {
          if (res.ok) showStatus("SMS sent successfully.");
          else showStatus("Failed to send SMS.", false);
        }).catch(() => showStatus("Server error.", false));
    }
  </script>
</body>
</html>
